name: Ghost-CLI
on:
  pull_request:
  push:
    branches:
      - master

jobs:
  test:
    runs-on: ubuntu-latest
    container: node:10
    steps:
      - uses: actions/checkout@v2
#      - run: git submodule update --init --force --recursive --depth=1
      - run: npm install -g ghost-cli@latest

      - uses: montudor/action-zip@v0.1.0
        with:
          args: zip -r ghost.zip .

      - name: Clean Install
        run: |
          DIR=$(mktemp -d)
          ghost install local -d $DIR --zip $GITHUB_WORKSPACE/ghost.zip

      - name: Latest Release
        run: |
          DIR=$(mktemp -d)
          ghost install local -d $DIR
          ghost update -d $DIR --zip $GITHUB_WORKSPACE/ghost.zip

#      - name: Previous Major
#        run: |
#          DIR=$(mktemp -d)
#          ghost install v2 --local -d $DIR
#          ghost update -f -d $DIR --zip $GITHUB_WORKSPACE/ghost.zip
